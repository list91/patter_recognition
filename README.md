# Switch Detection на электрических схемах

Проект для автоматической детекции объектов класса `switch` на электрических схемах с использованием YOLO11.

## Структура проекта

```
sheme-detect-eshkf/
├── data/
│   ├── images/
│   │   ├── train/        # Размеченные изображения для обучения
│   │   └── test/         # Неразмеченные изображения для тестирования
│   ├── labels/
│   │   └── train/        # Аннотации в формате YOLO
│   ├── pages-original/   # Оригинальные изображения схем
│   └── classes.txt       # Список классов
├── results/              # Результаты детекции (создаётся автоматически)
├── runs/                 # Логи обучения (создаётся автоматически)
├── data.yaml             # Конфигурация датасета
├── train.py              # Скрипт обучения модели
├── test_and_visualize.py # Скрипт тестирования и визуализации
├── run_all.bat           # Запуск всего пайплайна (Windows)
└── run_all.sh            # Запуск всего пайплайна (Linux/macOS)
```

## Установка зависимостей

```bash
pip install ultralytics
```

или

```bash
pip install ultralytics opencv-python
```

## Использование

### Вариант 1: Автоматический запуск (рекомендуется)

**Windows:**
```bash
run_all.bat
```

**Linux/macOS:**
```bash
./run_all.sh
```

Этот скрипт последовательно:
1. Обучит модель на размеченных данных (train.py)
2. Протестирует модель на неразмеченных схемах (test_and_visualize.py)
3. Сохранит результаты в папку `results/`

### Вариант 2: Пошаговый запуск

**Шаг 1: Обучение модели**
```bash
python train.py
```

Параметры обучения:
- Модель: YOLO11n (nano)
- Размер изображения: 1280px
- Эпохи: 150
- Batch size: 2
- Геометрические аугментации отключены (для схем)
- Цветовые аугментации включены умеренно

**Шаг 2: Тестирование и визуализация**
```bash
python test_and_visualize.py
```

Результаты будут сохранены в папке `results/` с префиксом `pred_`.

## Результаты

После успешного выполнения вы получите:

1. **Обученную модель:**
   - `runs/detect/train/weights/best.pt` - лучшая модель
   - `runs/detect/train/weights/last.pt` - последняя эпоха

2. **Графики обучения:**
   - `runs/detect/train/results.png` - метрики обучения
   - `runs/detect/train/confusion_matrix.png` - матрица ошибок

3. **Визуализация детекции:**
   - `results/pred_test_01.jpg` - изображения с bounding boxes
   - `results/pred_test_02.jpg`
   - и т.д.

## Особенности реализации

### Параметры обучения

Для электрических схем важно:
- **Отключены геометрические аугментации** (mosaic, fliplr, rotation) - схемы имеют строгую ориентацию
- **Включены цветовые аугментации** (HSV) - для устойчивости к разным сканам
- **Большой размер изображения** (1280px) - для детекции мелких объектов
- **Малый batch** (2) - из-за большого размера изображений

### Формат датасета

Аннотации в формате YOLO (нормализованные координаты):
```
class_id center_x center_y width height
```

Где:
- `class_id = 0` для класса `switch`
- Все координаты в диапазоне [0, 1]

## Требования

- Python 3.8+
- ultralytics
- opencv-python (для визуализации)

## Примечания

- При первом запуске YOLO автоматически скачает предобученные веса `yolo11n.pt`
- Обучение на CPU может занять продолжительное время
- Для ускорения рекомендуется использовать GPU (измените `device="cpu"` на `device="0"` в `train.py`)
- Текущий датасет содержит только 1 размеченное изображение - для продакшена нужно больше данных
